#!/bin/bash

airborn_src=`[ $1 ] && echo file://$(readlink -m $1) || echo https://github.com/twiss/airborn.git`
marketplace_src=`[ $2 ] && echo file://$(readlink -m $2) || echo https://github.com/twiss/airborn-marketplace-app.git`
firetext_src=`[ $3 ] && echo file://$(readlink -m $3) || echo https://github.com/codexa/firetext.git`
strut_src=`[ $4 ] && echo file://$(readlink -m $4) || echo https://github.com/twiss/Strut.git`

(
	echo Updating Airborn from $airborn_src
	rm -rf airborn &&
	git clone -q --depth 1 --recursive $airborn_src airborn
) &&
(
	echo Updating Marketplace from $marketplace_src
	rm -rf marketplace &&
	git clone -q --depth 1 --recursive $marketplace_src marketplace
) &&
(
	echo Updating Firetext from $firetext_src
	rm -rf firetext &&
	git clone -q --depth 1 --recursive $firetext_src firetext &&
	[ "$5" != "--build" ] ||
	(
		echo "Building Firetext..." &&
		firetext/builder/build --airborn &&
		rm -rf $(find firetext -mindepth 1 -maxdepth 1 | grep -v build$) &&
		cp -r firetext/build/* firetext &&
		rm -rf firetext/build
	)
) &&
(
	echo Updating Strut from $strut_src
	rm -rf strut &&
	git clone -q --depth 1 --recursive $strut_src strut
)